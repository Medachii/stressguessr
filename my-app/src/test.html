<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Test</title>
</head>

<body>
    <h1>Test</h1>
    <p>Test</p>
    <button onclick="test()"></button>
    <script>
        console.log("test");
        const phonemedictionnary = {
            '/': ['none'],
            'h': ['h'],
            'ə': ['e', 'a', 'ure', 'er', 'io', 'o', 're','ou', ''],
            'l': ['l', 'le'],
            'o': ['o'],
            'ʊ': ['u', 'oul', 'o','ugh'],
            '.': [''],
            'ɪ': ['i','a', 'e','u'],
            'l': ['l', 'le', 'll'],
            'i': ['i', 'ee', 'ea', 'y','e'],
            't': ['t', 'tt', 'te'],
            'ˈ': [''],
            'ˌ': [''],
            'b': ['b'],
            'ɑ': ['a'],
            'a': ['a','o'],
            'æ': ['a'],
            'e': ['e', 'a'],
            'ɝ': ['ear', 'ur'],
            'ɒ': ['o'],
            'ʌ': ['u'],
            'ɔ:': ['o', 'a', 'ou'],
            'u': ['u', 'oo', 'ue','ough'],
            'ː': ['none'],
            'aɪ': ['ai', 'i', 'eye'],
            'aʊ': ['ow', 'ou'],
            'eɪ': ['ay', 'ey', 'ei'],
            'oʊ': ['o', 'ou', 'ow'],
            'ɔɪ': ['oi', 'oy', 'oye'],
            'ɛ': ['e', 'ea'],
            'ɜ': ['o', 'or'],
            'ɹ': ['r', 're','rar'],
            'd': ['d'],
            'f': ['f','ph'],
            'g': ['g'],
            'j': ['y', 'j', ''],
            'k': ['k', 'c', 'ck', 'x','ch','q'],
            'm': ['m'],
            'n': ['n'],
            'ŋ': ['ng', 'n'],
            'p': ['p', 'pp'],
            'r': ['r', 'rr'],
            's': ['s', 'ss', ''],
            'ʃ': ['sh', 'ch', 'ss', ''],
            'tʃ': ['ch', 'tch'],
            'θ': ['th'],
            'ð': ['th'],
            'v': ['v'],
            'w': ['w','u'],
            'z': ['z', 'x','s','si'],
            'ʒ': ['zh', 'j', 's',],
            'd͡ʒ': ['j', 'g', 'ge', 'dge'],
            'ː': [''],
            'ɡ': ['g', 'gg', ''],
            'g': ['g'],
            '(': [''],
            ')': [''],
            'ɔ': ['o', 'a', 'ou'],
        }
        function extractPhoneme(data) {
            var phoneme = data[0].phonetics[0].text;
            //tant que le phoneme est null
            let i = 1;
            while (phoneme == null) {
                phoneme = data[0].phonetics[i].text;
                i++;
            }
            return phoneme;

        }


        function getPhoneme(word, callback) {
            const Http = new XMLHttpRequest();
            const url = "https://api.dictionaryapi.dev/api/v2/entries/en/{}".replace('{}', word);
            Http.open("GET", url);
            Http.send();
            Http.responseType = "json";
            Http.onload = () => {
                if (Http.readyState == 4 && Http.status == 200) {
                    const data = Http.response;
                    let extractedPhoneme = extractPhoneme(data);
                    console.log("extracted : " + extractedPhoneme);
                    callback(extractedPhoneme);
                }
            };
        }
        let stress = -2;
        let wordFinished = false;

        function findtheStress(word) {
            console.log("findtheStress");
            console.log("word : " + word);

            const phoneme = getPhoneme(word, (phoneme) => {
                console.log("pho " + phoneme);
                let index = 1;
                let finalWord = "";

                function findRecursiveStress(phoneme, index, wordToFind, finalWord) {

                    if (wordFinished==true) {
                        return;
                    }

                    console.log("----------------------------------------------------");
                    console.log("findRecursiveStress");
                    console.log("phoneme[index] : " + phoneme[index]);
                    console.log("finalWord : " + finalWord);
                    console.log("stress : " + stress);
                    console.log("wordFinished : " + wordFinished);
                    console.log("---------------------");
                    if (phoneme[index] == "/") {

                        if (stress == -2) {
                            stress = -1;
                        }
                        wordFinished = true;
                        console.log("stress non trouvé " + stress);
                        return;
                    }
                    if (phoneme[index] == "ˈ") {
                        console.log("stress trouvé");
                        console.log("index : " + index);
                        console.log("finalWord" + finalWord);
                        if (finalWord.length > stress) {
                            stress = finalWord.length;
                        }
                    }

                    for (let i = 0; i < phonemedictionnary[phoneme[index]].length; i++) {
                        if (wordFinished==true) {
                            break;
                        }
                        console.log("boucle, index : " + index + ", phoneme : " + phoneme[index] + " traduction du phoeneme : " + phonemedictionnary[phoneme[index]][i]);
                        let previousfinalWord = finalWord;
                        finalWord = finalWord + phonemedictionnary[phoneme[index]][i]
                        console.log("finalWord : " + finalWord);

                        //if finalWord is not the same as beginning of wordToFind then don't recall the function
                        if (wordToFind.startsWith(finalWord)) {
                            console.log("Ca commence bien ");
                            findRecursiveStress(phoneme, index + 1, wordToFind, finalWord);
                        }
                        finalWord = previousfinalWord;


                    }

                }

                if (phoneme.includes("ˈ")) {
                    console.log("wordToFind : " + word);
                    findRecursiveStress(phoneme, index, word, finalWord);
                }


                console.log("-----------------------------------------------------------------------");
                console.log("final stress : " + (stress));
                return;
                callback();
            });


        }

        function test() {
            findtheStress("contemporary");
        }
    </script>
</body>

</html>